/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FVendor%2Fauf%2Fglobal_common.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Vendor/auf/global_common.js?v=202406200958 **/
function af_publish(elt,event,pubName,pubData){if(typeof elt=='string'){elt=document.getElementById(elt);}
if(elt){return af_addEvent(elt,event,function(){PubSub.publish(pubName,pubData);},false);}}
function af_removeEvent(elt,event,listener,capture){if(elt.removeEventListener){elt.removeEventListener(event,listener,capture);}else if(elt.detachEvent){elt.detachEvent("on"+event,listener);}}
function af_stopEvent(e){if(!e)e=window.event;if(e){if(e.stop)e.stop();e.preventDefault?e.preventDefault():e.returnValue=false;e.stopPropagation?e.stopPropagation():e.cancelBubble=true;}}
function af_remove(e){if(e)e.parentNode.removeChild(e);}
var af_shortcuts={list:[],init:function(){af_shortcuts.loaded=true;af_addEvent(document,'keydown',function(e){if(!e){e=window.event;}
var t=(e.srcElement?e.srcElement:e.target);if(!t.nodeName.match(/(input|textarea|select)/gi)){if(!t.className.match(/(textarea)/gi)){for(var i=0,l=af_shortcuts.list;i<l.length;i++){if(e.keyCode==l[i].key){af_stopEvent(e);l[i].func.apply(null,[e]);}}}}},false);},add:function(k,f){af_shortcuts.list.push({key:k,func:f});if(!af_shortcuts.loaded){af_shortcuts.init();}}};function af_documentSize(){var b=document.body,e=document.documentElement;var x=Math.max(b.scrollWidth,e.scrollWidth,b.offsetWidth,e.offsetWidth,b.clientWidth,e.clientWidth);var y=Math.max(b.scrollHeight,e.scrollHeight,b.offsetHeight,e.offsetHeight,b.clientHeight,e.clientHeight);return{w:x,h:y};}
function af_smoothScroll(delay,left,top){var s=af_smoothScroll,now=(new Date()).getTime(),step=20;if(s.to){window.clearTimeout(s.to);s.to=0;}
if(delay){s.stop=now+delay;s.left=left;s.top=top;s.to=window.setTimeout(s,step);}else if(now>=s.stop){window.scrollTo(s.left,s.top);}else{var w=af_windowSize(),loop=(s.stop-now)/step;var sl=w.l+(s.left-w.l)/loop,st=w.t+(s.top-w.t)/loop;window.scrollTo(sl,st);s.to=window.setTimeout(s,step);}}
function af_throttle(fn,wait){var time=Date.now();return function(){if((time+wait-Date.now())<0){fn();time=Date.now();}}}
function af_gaqTrackEvent(category,action,opt_label,opt_value,opt_noninteraction,prefix){var opt_label=opt_label||'',opt_value=opt_value||0,opt_noninteraction=opt_noninteraction||false,prefix=prefix||'';if(typeof m_dataLayer!='undefined'){m_dataLayer.push({'event':'UA-Event','uaEventCategory':category,'uaEventAction':action,'uaEventLibelle':opt_label,'uaEventValue':opt_value,'uaEventNonInt':true});}else if(typeof af_dataLayer!='undefined'){af_dataLayer.push({'event':'UA - Event','eventCategory':category,'eventAction':action,'eventLabel':opt_label,'eventValue':opt_value,'eventNonInt':true});}else if(typeof _gaq!='undefined'){if(prefix!==''&&prefix.substr(-1)!=='.')prefix+='.';_gaq.push([prefix+'_trackEvent',category,action,opt_label,opt_value,opt_noninteraction]);}
if(typeof unify_dataSlayer!='undefined'){unify_dataSlayer.push({'event':'uaevent','eventCategory':category,'eventAction':action,'eventLabel':opt_label,'eventValue':opt_value,'eventNonInt':true});}}
function af_gaqRePush(url){var u=url?url:'/virtual'+document.location.pathname+(document.location.hash.replace('#','/')??'');if(typeof m_dataLayer!='undefined'){m_dataLayer.push({'event':'UA-VirtualPageView','virtualPageURL':u});}else if(typeof af_dataLayer!='undefined'){af_dataLayer.push({'event':'VirtualPageView','virtualPageURL':u});}else if(typeof _gaq!='undefined'){_gaq.push(['_trackPageview',u]);}else if(typeof pageTracker!=='undefined'){pageTracker._trackPageview(u);}
if(typeof unify_dataSlayer!='undefined'){unify_dataSlayer.push({'event':'virtualPageView','virtualPageURL':u});}}
function af_callTracking(suffix,url,filters){afSession.updatePageview();if(!filters||filters&&filters['ga']){af_gaqRePush(url);}
if(!filters||filters&&filters['comscore']){if(window.COMSCORE){COMSCORE.beacon({c1:2,c2:6034949,c3:'',c4:'',c5:'',c6:'',c15:''});}}
if(!filters||filters&&filters['estat']){if(window.eStatWhap&&_eStat_Whap_loaded){eStatWhap.send();}}
if(!filters||filters&&filters['ivw']){if(window.IVW){af_callTracking.ivwImg=new Image();af_callTracking.ivwImg.src=IVW.replace(/;$/,(suffix?'-'+suffix+';':';'))
+'?r='+escape(document.referrer)+'&d='+(Math.random()*100000);}
if(window.iom&&window.iam_data){var ivw_data=JSON.parse(JSON.stringify(iam_data));if(suffix){ivw_data.cp+='-'+suffix;}
iom.c(ivw_data,1);}
if(window.IOMm&&window.iom_data){var newIomData=JSON.parse(JSON.stringify(window.iom_data));var newIomDataCp=(suffix)?newIomData.cp+'-'+suffix:newIomData.cp;window.IOMm('pageview',{cp:newIomDataCp});}}
if(!filters||filters&&filters['netmetrix']){if(window.NETMX){af_callTracking.netmxImg=new Image();af_callTracking.netmxImg.src=NETMX
+'?r='+escape(document.referrer)
+'&d='+(Math.random()*100000);}}
if(!filters||filters&&filters['gemius']){if(window.gemius_hit&&window.af_gemius_identifier){gemius_hit(af_gemius_identifier);}}
if(!filters||filters&&filters['pixlog']){if(window.pixLog){pixLog.call();}}
PubSub.publish('tracking.call');af_GBounce_data=null;}
function af_setCookiePerm(cname,cvalue){var oldVal=af_getCookie(cname)||'';var _afpperso;var cookiesTab=document.cookie.split(';'),ln=cookiesTab.length;for(var i=0;i<ln;i++){var x=cookiesTab[i].substr(0,cookiesTab[i].indexOf('='));var y=cookiesTab[i].substr(cookiesTab[i].indexOf('=')+1);x=x.replace(/^\s+|\s+$/g,'');if(x=='afpperso'){_afpperso=y;break;}}
if(oldVal){var j,key,getVal,newCookie='',cookiesValuesTab=y.split('&');for(j=0;j<cookiesValuesTab.length;j++){key=cookiesValuesTab[j].substr(0,cookiesValuesTab[j].indexOf('='));if(key===cname){getVal='&'+key+'='+cvalue;}else{newCookie+=newCookie===''?'':'&';newCookie+=cookiesValuesTab[j];}}
if(getVal){_afpperso=newCookie+getVal;}}else{_afpperso=_afpperso+'&'+cname+'='+cvalue;}
var d=new Date();d.setTime(d.getTime()+(10*365*24*60*60*1000));var expires='; expires='+d.toUTCString();document.cookie='afpperso='+_afpperso+
expires+'; domain='+'.'+document.domain+'; path=/';}
function af_getCookie(name){var i,x,y;var cookiesTab=document.cookie.split(';');for(i=0;i<cookiesTab.length;i++){x=cookiesTab[i].substr(0,cookiesTab[i].indexOf('='));y=cookiesTab[i].substr(cookiesTab[i].indexOf('=')+1);x=x.replace(/^\s+|\s+$/g,'');if(x=='afperso'||x=='afpperso'){var j,a,cookiesValuesTab=y.split('&');for(j=0;j<cookiesValuesTab.length;j++){a=cookiesValuesTab[j].substr(0,cookiesValuesTab[j].indexOf('='));if(a==name){return unescape(cookiesValuesTab[j].substr(cookiesValuesTab[j].indexOf('=')+1));}}}else if(x==name){return y;}}
return'';}
function af_toggleText(pixelsLimit,elementsClassName){var numberOfToggled=document.getElementsByClassName(elementsClassName);for(i=0;i<numberOfToggled.length;i++){var el=numberOfToggled[i];if(el.scrollHeight>pixelsLimit){var more=null;more=document.createElement('a');more.className='more';more.href='#';more.innerHTML=af_translations.label_read_more_title;var readMore=null;readMore=document.createElement('div');readMore.className='read-more';readMore.appendChild(more);el.parentElement.appendChild(readMore);}}
window.onclick=function(event){if(event.target.className=='more'){event.preventDefault();event.target.parentElement.parentElement.classList.toggle('showAll');event.target.parentElement.parentElement.children[0].classList.toggle('af-toggle-text');if(event.target.innerHTML==''+af_translations.label_fold_message_title+''){event.target.innerHTML=af_translations.label_read_more_title;}else{event.target.innerHTML=af_translations.label_fold_message_title;}}}}
function af_requestGet(url,param,callback,json){var xhr=af_getXMLHttpRequest();callback=callback||null;json=json!=='undefined'?json:true;if(url.substr(0,1)==='/'){url=document.location.protocol+'//'+document.location.host+url;}
xhr.onreadystatechange=function(){if(xhr.readyState===4&&(xhr.status===200||xhr.status===0)){if(xhr.responseText){data=json?eval('('+xhr.responseText+')'):xhr.responseText;}else{data=null;}
if(callback){callback(data);}}};xhr.open('GET',(param!=='')?url+'?'+param:url,true);xhr.send(null);}
function af_requestPost(url,param,callback,json){var xhr=af_getXMLHttpRequest();callback=callback||null;json=json!=='undefined'?json:true;if(typeof af_personalHashValue!=='undefined'){param+='&personalKey='+af_personalHashValue;}
if(url.substr(0,1)=='/'){url=document.location.protocol+'//'+document.location.host+url;}
xhr.onreadystatechange=function(){if(xhr.readyState===4&&(xhr.status===200||xhr.status===0)){if(xhr.responseText){data=json?eval('('+xhr.responseText+')'):xhr.responseText;}else{data=null;}
if(callback){callback(data);}}};xhr.open('POST',url,true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.send(param);}
function af_getXMLHttpRequest(){var xhr=null;if(window.XMLHttpRequest||window.ActiveXObject){if(window.ActiveXObject){try{xhr=new ActiveXObject('Msxml2.XMLHTTP');}catch(e){xhr=new ActiveXObject('Microsoft.XMLHTTP');}}else{xhr=new XMLHttpRequest();}}
return xhr;}
function af_urlencode(str){str=(str+'').toString();return encodeURIComponent(str).replace(/!/g,'%21').replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/\*/g,'%2A').replace(/%20/g,'+');}
function af_inArray(elt,array){for(var i=0,l=array.length;i<l;i++){if(array[i]==elt)return true;}
return false;}
function af_trim(text){if(text!==undefined){return(""+text+"").replace(/(^\s*)|(\s*$)/g,"");}else{return text;}}
function af_getTarget(e){if(typeof e!=='undefined'){var _t=e.target||e.srcElement;}else{return'undefined';}
while(_t.classList.contains('action-parent')){_t=_t.parentNode;}
return _t;}
function af_getParent(e,pattern){var ret=null;if(e.nodeName=='HTML'){return null;}
if(typeof e!=='undefined'){var parent=e.parentNode;if(typeof pattern==='undefined'){ret=parent;}
else{var patterns=pattern.split(' ');var firstPattern=patterns.shift();var newPattern=patterns.join(' ');if(firstPattern.indexOf('.')===0){var cssClassLists=firstPattern.split('.');cssClassLists.shift();var cssFound=0;for(var n=0;n<cssClassLists.length;n++){if(e.classList.contains(cssClassLists[n])){cssFound++;}}
if(cssFound===cssClassLists.length){if(newPattern.length){ret=af_getParent(parent,newPattern);}else{ret=e;}}else{ret=af_getParent(parent,pattern);}}
else if(firstPattern.indexOf('#')===0){var id=firstPattern.substring(1);if(e.id===id){if(newPattern.length){ret=af_getParent(parent,newPattern);}else{ret=e;}}
else{ret=af_getParent(parent,pattern);}}
else{if(e.nodeType===1&&firstPattern.toUpperCase()===e.nodeName){if(newPattern.length){ret=af_getParent(parent,newPattern);}else{ret=e;}}
else{ret=af_getParent(parent,pattern);}}}
return ret;}
else{return undefined;}}
function af_tm_trackEvent(event){if(typeof m_dataLayer!='undefined'){m_dataLayer.push({'event':event});}else if(typeof af_dataLayer!='undefined'){af_dataLayer.push({'event':event});}
if(typeof unify_dataSlayer!='undefined'){unify_dataSlayer.push({'event':event});}};var AfHttpRequest=(function(){var getXMLHttpRequest=function(){var xhr=null;if(window.XMLHttpRequest||window.ActiveXObject){if(window.ActiveXObject){try{xhr=new ActiveXObject('Msxml2.XMLHTTP');}catch(e){xhr=new ActiveXObject('Microsoft.XMLHTTP');}}else{xhr=new XMLHttpRequest();}}
return xhr;};var getRequest=function(callback,json,withErrors){var xhr=af_getXMLHttpRequest();callback=callback||null;json=json!=='undefined'?json:true;withErrors=withErrors!=='undefined'?withErrors:false;xhr.onreadystatechange=function(){if(xhr.readyState===4&&(withErrors||xhr.status===200||xhr.status===201||xhr.status===202||xhr.status===204||xhr.status===0)){if(xhr.responseText){data=json?eval('('+xhr.responseText+')'):xhr.responseText;}else{data=null;}
if(callback){callback(data,xhr);}}};return xhr;};var getRequestWithCallback=function(callback,json){var xhr=af_getXMLHttpRequest();callback=callback||null;json=json!=='undefined'?json:true;xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.responseText){data=json?eval('('+xhr.responseText+')'):xhr.responseText;}else{data=null;}
if(callback){callback(data,xhr);}}};return xhr;};var getAbsoluteUrl=function(url){if(url.substr(0,1)==='/'){url=document.location.protocol+'//'+document.location.host+url;}
return url;};var getData=function(param){var data=((typeof param!=='undefined')&&(param!==null)&&(param!=='undefined'))?param:'';if(typeof af_personalHashValue!=='undefined'){data+='&personalKey='+af_personalHashValue;}
return data;};return{get:function(url,param,callback,json,withErrors){var xhr=getRequest(callback,json,withErrors);var absoluteUrl=getAbsoluteUrl(url);xhr.open('GET',(param!=='')?absoluteUrl+'?'+param:absoluteUrl,true);xhr.send(null);},post:function(url,param,callback,json,withErrors){var xhr=getRequest(callback,json,withErrors);var absoluteUrl=getAbsoluteUrl(url);var data=((typeof param==='object')&&(param!==null))?JSON.stringify(param):getData(param);var contentType=((typeof param==='object')&&(param!==null))?'application/json':'application/x-www-form-urlencoded';xhr.open('POST',absoluteUrl,true);xhr.setRequestHeader('Content-Type',contentType);xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.send(data);},postMultipart:function(url,param,callback,json){var xhr=getRequest(callback,json);var absoluteUrl=getAbsoluteUrl(url);var data=getData(param);xhr.open('POST',absoluteUrl,true);xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.send(data);},put:function(url,param,callback,json){var xhr=getRequest(callback,json);var absoluteUrl=getAbsoluteUrl(url);var data=typeof param==='object'?JSON.stringify(param):getData(param);var contentType=typeof param==='object'?'application/json':'application/x-www-form-urlencoded';xhr.open('PUT',absoluteUrl,true);xhr.setRequestHeader('Content-Type',contentType);xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.send(data);},patch:function(url,param,callback,json){var xhr=getRequest(callback,json);var absoluteUrl=getAbsoluteUrl(url);var data=typeof param==='object'?JSON.stringify(param):getData(param);var contentType=typeof param==='object'?'application/json':'application/x-www-form-urlencoded';xhr.open('PATCH',absoluteUrl,true);xhr.setRequestHeader('Content-Type',contentType);xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.send(data);},del:function(url,param,callback,json){var xhr=getRequest(callback,json);var absoluteUrl=getAbsoluteUrl(url);xhr.open('DELETE',(param!=='')?absoluteUrl+'?'+param:absoluteUrl,true);xhr.send(null);}};})();function connectedUserOnlyAction(e){var _t=af_getTarget(e);PubSub.publish('connectedUsersOnly',_t);af_stopEvent(e);var href=this.href||this.getAttribute('data-href')||window.location.href;var url;url='/reloaded/users/login?destUrl=';window.location.href='https://'+document.domain+url+encodeURIComponent(href);return false;}
if(typeof(af_addEvent)!=='undefined'){var connected=false;if(af_getCookie('cu')!==''){var connected=true;}
if(!connected&&typeof document.getElementsByClassName!=='undefined'){var elements=document.getElementsByClassName('connectedUsersOnly');for(var i=elements.length-1;i>=0;i--){var element=elements[i];element.classList.remove('connectedUsersOnly');if(element.onclick){element.previousOnclick=element.onclick;element.onclick=null;}
af_addEvent(element,'click',af_bind(element,connectedUserOnlyAction),true);}}}
function af_checkNested(obj){var args=Array.prototype.slice.call(arguments,1);for(var i=0;i<args.length;i++){if(!obj||!obj.hasOwnProperty(args[i])){return false;}
obj=obj[args[i]];}
return true;}
function af_encryptHref(aTag){var url=aTag.getAttribute("data-href");var target=aTag.getAttribute("target");if(target=="_blank"){var otherWindow=window.open();otherWindow.opener=null;otherWindow.location=url;}else{window.location.href=url;}}
(function openNewTab(){var links=document.getElementsByClassName('_blank');for(var i in links){if(typeof links[i]==='object'){af_addEvent(links[i],'click',(function(e){_t=af_getParent(af_getTarget(e),'._blank');window.open(_t.getAttribute('href'),'_blank');af_stopEvent(e);}).bind(this),false);}}})();(function(){var keyboardeventKeyPolyfill={polyfill:polyfill,keys:{3:'Cancel',6:'Help',8:'Backspace',9:'Tab',12:'Clear',13:'Enter',16:'Shift',17:'Control',18:'Alt',19:'Pause',20:'CapsLock',27:'Escape',28:'Convert',29:'NonConvert',30:'Accept',31:'ModeChange',32:' ',33:'PageUp',34:'PageDown',35:'End',36:'Home',37:'ArrowLeft',38:'ArrowUp',39:'ArrowRight',40:'ArrowDown',41:'Select',42:'Print',43:'Execute',44:'PrintScreen',45:'Insert',46:'Delete',48:['0',')'],49:['1','!'],50:['2','@'],51:['3','#'],52:['4','$'],53:['5','%'],54:['6','^'],55:['7','&'],56:['8','*'],57:['9','('],91:'OS',93:'ContextMenu',106:'*',107:'+',109:'-',110:'.',111:'/',144:'NumLock',145:'ScrollLock',181:'VolumeMute',182:'VolumeDown',183:'VolumeUp',186:[';',':'],187:['=','+'],188:[',','<'],189:['-','_'],190:['.','>'],191:['/','?'],192:['`','~'],219:['[','{'],220:['\\','|'],221:[']','}'],222:["'",'"'],224:'Meta',225:'AltGraph',246:'Attn',247:'CrSel',248:'ExSel',249:'EraseEof',250:'Play',251:'ZoomOut'}};var i;for(i=1;i<25;i++){keyboardeventKeyPolyfill.keys[111+i]='F'+i;}
var letter='';for(i=65;i<91;i++){letter=String.fromCharCode(i);keyboardeventKeyPolyfill.keys[i]=[letter.toLowerCase(),letter.toUpperCase()];}
for(i=96;i<106;i++){letter=String.fromCharCode(i-48);keyboardeventKeyPolyfill.keys[i]=letter;}
function polyfill(){var isEdgeOrIE=(navigator.userAgent.indexOf("MSIE ")>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)||navigator.userAgent.indexOf("Edge/")>0);if(!('KeyboardEvent'in window)||('key'in KeyboardEvent.prototype&&!isEdgeOrIE)){return false;}
var proto={get:function(x){var key=keyboardeventKeyPolyfill.keys[this.which||this.keyCode];if(Array.isArray(key)){key=key[+this.shiftKey];}
return key;},enumerable:true,configurable:true};Object.defineProperty(KeyboardEvent.prototype,'key',proto);return proto;}
if(typeof define==='function'&&define.amd){define('keyboardevent-key-polyfill',keyboardeventKeyPolyfill);}else if(typeof exports!=='undefined'&&typeof module!=='undefined'){module.exports=keyboardeventKeyPolyfill;}else if(window){window.keyboardeventKeyPolyfill=keyboardeventKeyPolyfill;}})();keyboardeventKeyPolyfill.polyfill();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FVendor%2Fauf%2Fglobal_desktop.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Vendor/auf/global_desktop.js?v=202406200958 **/
var af_popup={init:function(){this.init_done=true;var backgroundcolor=(typeof(siteId)!=='undefined'&&siteId===13)?' #FF6F61':' #951f60';this.global=document.createElement('div');this.global.style.display='none';this.global.style.bottom='0';this.global.style.left='0';this.global.style.right='0';this.global.style.top='0';this.global.style.overflow='hidden';this.global.style.position='fixed';this.global.style.zIndex='99999998';this.global.style.overflowY='auto';this.global.innerHTML='';document.body.appendChild(this.global);this.background=document.createElement('div');this.background.style.backgroundColor='#FFFFFF';this.background.style.opacity='0.7';this.background.style.position='absolute';this.background.style.top='0';this.background.style.left='0';this.background.style.width=document.body.clientWidth;this.background.style.height='100%';this.background.innerHTML='';this.global.appendChild(this.background);this.container=document.createElement('div');this.container.style.backgroundColor='#FFFFFF';this.container.style.position='absolute';this.container.style.boxShadow='0 0 10px rgba(0, 0, 0, 0.2)';this.container.style.webkitBoxShadow='0 0 10px rgba(0, 0, 0, 0.2)';this.container.style.mozBoxShadow='0 0 10px rgba(0, 0, 0, 0.2)';this.container.style.msBoxShadow='0 0 10px rgba(0, 0, 0, 0.2)';this.container.style.margin='6px';this.container.innerHTML='<span class="icon icon-close-btn" '+'style="position:absolute; top: -14px; right: -14px; width: 10px; height: 10px; padding:10px; background-color:'+
backgroundcolor+'; line-height: 10px; color: white; cursor:pointer; border-radius: 15px;"'+'onclick="af_popup.end(false)"></span>'+'<iframe id="af_popup_iframe" src="/shim.gif" scrolling=no frameborder=0></iframe>';this.global.appendChild(this.container);this.iframe=document.getElementById('af_popup_iframe');af_addEvent(window,'resize',function(){af_popup.resize();},false);af_addEvent(this.background,'click',function(){af_popup.end(false);},false);af_shortcuts.add(27,function(){af_popup.hide();});},show:function(w,h,url,successCallback){if(!this.init_done){this.init();}
this.url=url;this.successCallback=successCallback;this.global.style.display='';url+=((url.indexOf('?')>0)?'&':'?')+'af_popup=1';this.iframe.src=url;w=(typeof w==='undefined')?'400':w;h=(typeof h==='undefined')?'300':h;this.resize(w,h);var scrollbarSize=17;document.body.style.marginRight=scrollbarSize+'px';document.body.style.overflow='hidden';this.isShown=true;},end:function(success){this.hide();if(success&&typeof this.successCallback==='function'){this.successCallback();}},hide:function(){if(this.isShown){this.isShown=false;this.global.style.display='none';document.body.style.marginRight='0px';document.body.style.overflow='visible';this.iframe.src='/shim.gif';}},resize:function(w,h){if(this.iframe){this.w=(typeof w==='undefined')?this.w:w;this.h=(typeof h==='undefined')?this.h:h;this.iframe.width=this.w;this.iframe.height=this.h;var win=af_windowSize();this.container.style.top=Math.max(0,((win.h-this.h-20)/2))+'px';this.container.style.left=Math.max(0,((win.w-this.w-20)/2))+'px';this.background.style.width=win.w+'px';this.background.style.height=this.global.scrollHeight+'px';}}};var af_popup_social={init:function(w){this.initDone=true;this.global=document.createElement('div');this.global.style.bottom='0';this.global.style.right='0';this.global.style.position='fixed';this.global.style.zIndex='100001';this.global.style.marginRight='-'+w+'px';var transition='margin-right 0.4s ease-in-out';this.global.style['-webkit-transition']=transition;this.global.style['-moz-transition']=transition;this.global.style['-o-transition']=transition;this.global.style['transition']=transition;document.body.appendChild(this.global);this.container=document.createElement('div');this.container.style.backgroundColor='#FFFFFF';this.container.style.border='1px solid #e9ebee';this.container.innerHTML='<iframe id="af_popup_social_iframe" src="/shim.gif" scrolling=no frameborder=0></iframe>';this.global.appendChild(this.container);this.iframe=document.getElementById('af_popup_social_iframe');},show:function(url,w,h){w=(typeof w==='undefined')?'400':w;h=(typeof h==='undefined')?'300':h;if(!this.initDone){this.init(w);}
if(this.url!==url){this.url=url;this.iframe.src=url;}
if(this.h!==h){this.h=h;this.iframe.height=h;}
if(this.w!==w){this.w=w;this.iframe.width=w;}
this.global.style.marginRight='0';this.isShown=true;},hide:function(){if(this.isShown){this.isShown=false;this.global.style.marginRight='-'+this.w+'px';}}};(function(){if(typeof(Storage)!=='undefined'){var x='__storage_test__';try{localStorage.setItem(x,1);localStorage.removeItem(x);}catch(e){Storage.prototype._setItem=Storage.prototype.setItem;Storage.prototype.setItem=function(){};}}})();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FVendor%2Fauf%2FafStickyCol.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Vendor/auf/afStickyCol.js?v=202406200958 **/
var AfStickyCol=(function(){var stickyCol=function(){};stickyCol.prototype={constructor:stickyCol,init:function(opts){if(typeof window.pegasus!=='undefined'||typeof window.pegasusConf!=='undefined')
return;this.extraBottom=opts.extraBottom||0;this.parentTop=opts.parentTop||0;this.noFixed=false;this.container=document.getElementById(opts.id);this.bottomCtn=opts.bottomCtn;this.hasRun=false;this.marginTop=opts.marginTop||70;this.superParent=opts.superParent||false;this.forceXRedraw=opts.forceXRedraw||false;this.widthBreakpoint=opts.widthBreakpoint||1024;var scrollTimer;this.scrollHandler=this.onScroll.bind(this,scrollTimer);if(this.parentTop>0){document.getElementById(opts.id).style.top=this.parentTop+'px';}
var resizeTimer;this.resizeHandler=this.onResize.bind(this,resizeTimer);af_addEvent(window,'resize',this.resizeHandler,false);this.run();PubSub.subscribe('stardust.open',af_bind(this,this.disable));},disable:function(){this.noFixed=true;},isEnabled:function(){if(this.noFixed){this.reset();return false;}
return af_windowSize().w>=this.widthBreakpoint;},run:function(){if(!this.hasRun&&this.isEnabled()&&this.container&&typeof this.container.parentNode==='object'){this.hasRun=true;this.parent=this.container.parentNode;this.parentInitialStyle=this.parent.style.cssText;this.parent.style.position='relative';this.currentElt=null;this.elements=[];this.index=0;this.scroll={};var checkCondition;if(this.superParent){checkCondition=false;}else{checkCondition=this.container.offsetHeight>=this.parent.offsetHeight;}
if(checkCondition){this.parent.style.height=this.container.offsetHeight+'px';}else{this.checkElements(this.container.children);if(this.elements.length>0&&typeof this.scrollHandler==='function'){this.setElementsPosition();af_addEvent(window,'scroll',this.scrollHandler,false);}}}},reset:function(){if(this.hasRun){this.hasRun=false;this.parent.style.cssText=this.parentInitialStyle;for(var i=0;i<this.elements.length;i++){this.elements[i].node.style.cssText=this.elements[i].initialStyle;}
af_removeEvent(window,'scroll',this.scrollHandler,false);}},checkElements:function(elements){for(var i=0;i<elements.length;i++){var element=elements[i];if(typeof element==='object'){this.elements.push({node:element});}}},setElementsPosition:function(){var margin=0;var marginBetween=Math.round(this.parent.offsetHeight/this.elements.length);for(var i=0;i<this.elements.length;i++){this.elements[i].initialStyle=this.elements[i].node.style.cssText;this.elements[i].node.style.position='absolute';this.elements[i].node.style.top=margin+'px';this.elements[i].node.style.marginTop=0;if(i>0){this.elements[i].prev=this.elements[i-1];this.elements[i-1].next=this.elements[i];}
margin=margin+marginBetween;}
this.setElement();},setElement:function(){this.currentElt=(this.elements.length>this.index)?this.elements[this.index]:null;},setNextElement:function(){if(this.elements.length>(this.index+1)){this.index++;this.setElement();}},setPrevElement:function(){if(this.index>0){this.index--;this.setElement();}},stick:function(){if(this.currentElt&&!this.currentElt.isSticked){this.currentElt.isBottom=false;this.currentElt.isSticked=true;if(this.forceXRedraw){var left=this.currentElt.node.getBoundingClientRect().left;var right=this.currentElt.node.getBoundingClientRect().right;var width=right-left;this.currentElt.node.style.left=left+'px';this.currentElt.node.style.width=width+'px';}
this.currentElt.node.style.position='fixed';this.currentElt.node.style.transform='translate3d(0, 0, 0)';this.currentElt.node.style.top=this.marginTop+'px';}},unstick:function(offsetTop,bottomCollision){if(this.currentElt&&this.currentElt.isSticked&&typeof this.parent==='object'){this.currentElt.isSticked=false;this.currentElt.node.style.position='absolute';if(this.forceXRedraw){this.currentElt.node.style.width='';this.currentElt.node.style.left='';}
var top=offsetTop;if(bottomCollision){this.currentElt.isBottom=true;top+=this.extraBottom;}
this.currentElt.node.style.top=top+'px';}},checkNextCollision:function(){var elementOffset=this.currentElt.node.getBoundingClientRect();var bottomCollision,nextCollision,offsetTop;if(this.currentElt.next){var nextElementOffset=this.currentElt.next.node.getBoundingClientRect();nextCollision=elementOffset.top+this.currentElt.node.offsetHeight>=nextElementOffset.top;offsetTop=this.currentElt.next.node.offsetTop-this.currentElt.node.offsetHeight;}else{var offsetBottom;if(typeof this.bottomCtn==='object'){offsetBottom=this.bottomCtn.getBoundingClientRect().bottom;offsetTop=this.bottomCtn.offsetHeight-this.currentElt.node.offsetHeight;}else{offsetBottom=this.parent.getBoundingClientRect().bottom;offsetTop=this.parent.offsetHeight-this.parentTop-this.currentElt.node.offsetHeight;}
bottomCollision=(elementOffset.bottom>=offsetBottom);}
if(nextCollision||bottomCollision){this.unstick(offsetTop,bottomCollision);this.setNextElement();}else if(elementOffset.top<=this.marginTop&&!this.currentElt.isBottom){this.stick();}},checkPrevCollision:function(){var containerOffset=this.container.getBoundingClientRect();var elementOffset=this.currentElt.node.getBoundingClientRect();var prevCollision;if(this.currentElt.prev){var prevElementOffset=this.currentElt.prev.node.getBoundingClientRect();prevCollision=elementOffset.bottom-this.currentElt.node.offsetHeight<=prevElementOffset.bottom;}
if(prevCollision){var offsetTop=this.currentElt.prev.node.offsetTop+this.currentElt.prev.node.offsetHeight;this.unstick(offsetTop);this.setPrevElement();}else if(containerOffset.top>this.marginTop){this.unstick(0);}else if(elementOffset.top>=this.marginTop){this.stick();}},onResize:function(timer){var that=this;clearTimeout(timer);timer=setTimeout(function(){if(that.isEnabled()){that.run();}else{that.reset();}},100);},onScroll:function(timer){if(typeof this.container==='object'&&typeof this.parent==='object'&&this.currentElt){var that=this;clearTimeout(timer);timer=setTimeout(function(){that.setScrollDir();if(that.scroll.dir==='down'){that.checkNextCollision();}else if(that.scroll.dir==='up'){that.checkPrevCollision();}},50);}else if(typeof this.scrollHandler==='function'){af_removeEvent(window,'scroll',this.scrollHandler,false);}},setScrollDir:function(e){if(typeof this.scroll.x==='undefined'){this.scroll.x=this.windowXOffset();this.scroll.y=this.windowYOffset();}
var diffX=this.scroll.x-this.windowXOffset();var diffY=this.scroll.y-this.windowYOffset();if(diffX>0){this.scroll.dir='left';}else if(diffY<0){this.scroll.dir='down';}else if(diffY>0){this.scroll.dir='up';}
this.scroll.x=this.windowXOffset();this.scroll.y=this.windowYOffset();},windowXOffset:function(){return window.pageXOffset||document.documentElement.scrollLeft;},windowYOffset:function(){return window.pageYOffset||document.documentElement.scrollTop;}};return stickyCol;})();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FPageType%2FrecipeV2%2FrecipeV2.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/PageType/recipeV2/recipeV2.js?v=202406200958 **/
var Mrtn=Mrtn||{};Mrtn.Recipe=(function(){var recipe=function(){this.listenToStarOrigin;this.listenToStar;this.recipe=Mrtn.recipesData.recipes[0];this.recipe.initial_nb_pers=this.recipe.nb_pers;Mrtn.store=Mrtn.store||{};var that=this;PubSub.subscribe('star:listenChange',function(msg,data){that.listenToStar=data;});PubSub.subscribe('star:listenChangeOrigin',function(msg,data){that.listenToStarOrigin=data;});window.onbeforeprint=this.beforePrint.bind(this);this.elReview=document.getElementsByClassName('reviewsAdd__modal')[0];this.reviewAddModal=new Mrtn.Modal({el:this.elReview});let _this=this;PubSub.subscribe('review:add-review',function(msg,d){_this.reviewAddOpen(d.el,d.starValue);});this.reviewModalContent=document.getElementById('review-add-content');if(Mrtn.USER){Mrtn.USER.pushQueue(_this.reviewBoxHandler);}
let atc=document.querySelectorAll('.atc');for(let i=0;i<atc.length;i++){af_addEvent(atc[i],'click',this.onClickAtc.bind(this),false);}
if(this.recipe.id===86989){window.JoinStories.load('https://stories.marmiton.org/recette-cookies-maison-3gaZniXfM/');}};recipe.prototype={constructor:recipe,reviewIsOpen:false,reviewAddOpen:function(elem,starValue){this.reviewAddModal.open();if(!this.reviewIsOpen){var formClone=elem.cloneNode(true);formClone.id='bloc-comment-clone';this.reviewModalContent.appendChild(formClone);this.reviewIsOpen=true;PubSub.publish('review:bindForm');}else{var that=this;PubSub.publish('starRating:update',{value:starValue,guuid:that.listenToStar});PubSub.publish('starRating:update',{value:0,guuid:that.listenToStarOrigin});}
return false;},reviewBoxHandler:function(){if(Mrtn.USER&&Mrtn.RECIPE&&Mrtn.USER.contribs){var recipes=Mrtn.USER.contribs.author||[];var reviews=Mrtn.USER.contribs.review||[];var recipeId=Mrtn.RECIPE.id;if(recipes.indexOf(recipeId)!==-1){document.body.classList.add('mrtn-is-author');}
if(reviews.indexOf(recipeId)!==-1){document.body.classList.add('mrtn-is-reviewer');}}},onClickAtc:function(e){var el;if(e.target.classList.contains('atc')){el=e.target;}else{el=af_findAncestor(e.target,'atc');}
let attribute=el.getAttribute('data-atc');if(e.ctrlKey||el.classList.contains('atc-blank')){let newWindow=window.open(decodeURIComponent(window.atob(attribute)),'_blank');newWindow.focus();}else{document.location.href=decodeURIComponent(window.atob(attribute));}},beforePrint:function(e){Mrtn.ingredientsUtensils.viewIngredients();Mrtn.recipeIngredientList.viewText();Mrtn.recipeIngredientList.toggleShowMore(true);af_stopEvent(e);}};return recipe;})();var recipeAlertModal;jquery$(function(){var recipe=new Mrtn.Recipe();});




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FComponent%2FstarsRating%2FstarsRating.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Component/starsRating/starsRating.js?v=202406200958 **/
var Mrtn=Mrtn||{};Mrtn.StarRating=(function(){var starRating=function(params){this.starContainer=params.starContainer||document.querySelector('.mrtn-stars:not([data-mode=readonly])');this.stars=params.stars||Array.prototype.slice.call(this.starContainer.children);this.totalStars=params.totalStars||4;this.isClone=params.isClone||false;this.rated=params.rated||document.getElementById('rated');this.input=params.input||this.createInput();this.guuid=this.setGUUID();af_addEvent(this.starContainer,'click',this.rate.bind(this),false);var _this=this;PubSub.subscribe('starRating:update',function(msg,data){_this.updateRate(data.guuid,data.value);});};starRating.prototype={constructor:starRating,createInput:function(isClone){var input;if(!this.isClone){input=document.createElement('input');input.className='mrtn-stars__input-rate';input.name='rating';input.type='hidden';this.starContainer.appendChild(input);}else{input=this.starContainer.getElementsByClassName('mrtn-stars__input-rate')[0];}
return input;},rate:function(e){var index=this.stars.indexOf(e.target);var count=this.totalStars-index+1;this.stars.forEach(function(el){el.classList.remove('is-selected')})
e.target.classList.add('is-selected');this.input.value=count;},setGUUID:function(){return Math.random().toString(16).substr(2,8);},getGUUID:function(){return this.guuid;},updateRate:function(guuid,val){if(this.guuid===guuid){this.input.value=parseInt(val);var stars=this.starContainer.getElementsByClassName('mrtn-star');this.stars.forEach(function(el){el.classList.remove('is-selected')})
var count=this.totalStars-parseInt(val)+1;for(var i in stars){if(typeof stars[i]==='object'&&count===parseInt(i)){stars[i].classList.add('is-selected');}}}}}
return starRating;})();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FComponent%2FrecipeReviewsListV2%2FrecipeReviewsListV2.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Component/recipeReviewsListV2/recipeReviewsListV2.js?v=202406200958 **/
(function(){var recipeReviewsListContainer=document.querySelector('#recipe-reviews-list__container');var seeMoreButton=recipeReviewsListContainer.querySelector('.recipe-reviews-list__see-more-button');af_addEvent(seeMoreButton,'click',function(){if(unify_dataSlayer!==undefined){unify_dataSlayer.push({event:'uaevent',eventCategory:'Recipe Reviews',eventAction:'see_recipe_reviews'});}},false);var usefulClick=function(e){var el=e.target;var queryParams={userid:Mrtn.USER.id,reviewid:el.dataset.reviewId,isUseful:el.dataset.isuseful==='1'?'0':'1',};var queryString=Object.keys(queryParams).map(function(k){return k+'='+encodeURIComponent(queryParams[k]);}).join('&');var url='/reloaded/api/recipe/updateusefulreview';AfHttpRequest.post(url,queryString,function(r){r=JSON.parse(r);if(r.status===1){el.classList.add('icon-icon_useful');el.classList.remove('icon-icon_useful_focus');el.dataset.isuseful='0';}else if(r.status===2){el.classList.remove('icon-icon_useful');el.classList.add('icon-icon_useful_focus');el.dataset.isuseful='1';}});};if(Mrtn&&Mrtn.USER&&Mrtn.USER.id){var usefulIcons=recipeReviewsListContainer.getElementsByClassName('recipe-review-like__like__icon');for(var i=0;i<usefulIcons.length;i++){af_addEvent(usefulIcons[i],'click',usefulClick,true);}
var queryParams={userId:Mrtn.USER.id,recipeId:recipeReviewsListContainer.dataset.recipeId,order:'creationDate',limit:3,page:1};var queryString=Object.keys(queryParams).map(function(k){return k+'='+encodeURIComponent(queryParams[k]);}).join('&');var url='/reloaded/api/recipe/getrecipereviews';AfHttpRequest.get(url,queryString,function(r){var reviews=JSON.parse(r).data.items;for(var j=0;j<reviews.length;j++){var likeIcon=recipeReviewsListContainer.querySelector('.recipe-review-like__like__icon[data-review-id="'+reviews[j]['id']+'"]');if(likeIcon&&reviews[j]['isUserUseful']){likeIcon.classList.remove('icon-icon_useful');likeIcon.classList.add('icon-icon_useful_focus');likeIcon.dataset.isuseful='1';}}});}})();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FPageType%2Frecipe%2Ftemplate-engine.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/PageType/recipe/template-engine.js?v=202406200958 **/
(function(){var cache={};this.tmpl=function tmpl(str,data){var fn=!/\W/.test(str)?cache[str]=cache[str]||tmpl(document.getElementById(str).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+
str.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")
+"');}return p.join('');");return data?fn(data):fn;};})();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FComponent%2FrecipeMemoV2%2FrecipeMemoV2.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Component/recipeMemoV2/recipeMemoV2.js?v=202406200958 **/
var Mrtn=Mrtn||{};Mrtn.recipeMemoV2=(function(){var recipeMemoV2=function(){this.comment='';this.recipeId=Mrtn.RECIPE.id;if(typeof Mrtn.USER!=='undefined'&&Mrtn.USER.id){this.cookbooks=Mrtn.cookbooks||new Mrtn.Cookbooks({user:Mrtn.USER});Mrtn.cookbooks.pushQueue(this.getRecipeMemo.bind(this));}
this.renderRecipeMemo();this.bindAll();};recipeMemoV2.prototype={constructor:recipeMemoV2,bindAll:function(){af_addEvent(this.input,'keyup',this.addMemoToRecipe.bind(this),false);let iconEdit=document.getElementById('recipe-memo-icon');af_addEvent(iconEdit,'click',this.toggleInputClass.bind(this),false);},getRecipeMemo:function(){this.recipe=this.cookbooks.getRecipeFromSurId(this.recipeId);if(this.recipe.length>0&&typeof this.recipe[0].Comment!=='undefined'){this.comment=this.recipe[0].Comment;}},renderRecipeMemo:function(){if(!this.comment){return;}
let template=document.getElementById('recipe-memo-template').innerHTML;let el=tmpl(template,{comment:this.comment});let recipeMemo=document.querySelector('.recipe-memo');recipeMemo.insertAdjacentHTML('beforeend',el);this.input=document.querySelector('input[name="recipeMemo"]');this.toggleInputClass();},addMemoToRecipe:function(e){if(e.keyCode===13){this.comment=this.input.value;this.toggleInputClass();let successCallback=function(){PubSub.publish('noty',{content:'Votre mémo a bien été sauvegardé sur la recette',timer:6000});Mrtn.USER.getUserContributions({fetch:true});};let categoryGuid=this.recipe.length>0?this.recipe.categoryId:Mrtn.recipesData.recipes[0].category_id;let params={recipeid:this.recipeId,categoryguid:categoryGuid,comment:this.input.value,successCallback:successCallback};this.cookbooks.addRecipe(params);}},toggleInputClass:function(){let recipeMemo=document.getElementById('recipe-memo');if(recipeMemo.classList.contains('mrtn-input')&&this.comment){recipeMemo.classList.remove('mrtn-input');recipeMemo.classList.add('mrtn-input--with-memo');this.input.disabled=true;}else{recipeMemo.classList.remove('mrtn-input--with-memo');recipeMemo.classList.add('mrtn-input');this.input.disabled=false;}},};return recipeMemoV2;})();var recipeMemoV2=new Mrtn.recipeMemoV2();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FComponent%2FrecipeCounter%2FrecipeCounter.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Component/recipeCounter/recipeCounter.js?v=202406200958 **/
var Mrtn=Mrtn||{};Mrtn.RecipeCounter=(function(param){var recipeCounter=function(givenParams){this.params={containerClass:givenParams.containerClass||'recipe-ingredients__qt-counter',container:givenParams.container,unit:givenParams.unit||null,onchange:givenParams.onchange,value:givenParams.value||'',size:givenParams.size||'',min:givenParams.min||0,max:givenParams.max,dataset:givenParams.dataset||[],};this.params.withUnit=null!==this.params.unit;let template=document.getElementById(this.params.containerClass+'_template').innerHTML;let widget=tmpl(template,this.params);if('undefined'===typeof givenParams.replace){this.params.container.insertAdjacentHTML('beforeend',widget);}else{this.params.container.innerHTML=widget;}
this.input=this.params.container.querySelector('.'+this.params.containerClass+' input');if(this.params.dataset.length>0){for(let i=0;i<this.params.dataset.length;i++){const item=this.params.dataset[i];this.input.dataset[item.name]=item.value;}}
this.min=this.params.min;this.max=this.params.max;this.action=null;this.counterMinus=this.params.container.querySelector('.'+this.params.containerClass+' .minus');this.counterPlus=this.params.container.querySelector('.'+this.params.containerClass+' .plus');af_addEvent(this.input,'change',function(e){this.callback(e);}.bind(this),false);af_addEvent(this.counterMinus,'click',this.decreaseCounter.bind(this),false);af_addEvent(this.counterPlus,'click',this.increaseCounter.bind(this),false);if(this.params.containerClass==='quantity-counter'){this.input.style.width=this.input.value.toString().length+'ch';}};recipeCounter.prototype={constructor:recipeCounter,decreaseCounter:function(e){this.action='Minus';this.updateCounter(-1,e);},increaseCounter:function(e){this.action='Plus';this.updateCounter(1,e);},updateCounter:function(value,event){let val=Math.max(parseInt(this.input.value)+value,parseInt(this.min));if(this.max){val=Math.min(val,parseInt(this.max));}
this.input.value=val;if(this.params.containerClass==='quantity-counter'){this.input.style.width=this.input.value.toString().length+'ch';}
this.callback(event);},callback:async function(event=null){let onchange=this.params.onchange;if('function'===typeof onchange){await onchange(event);}else if('string'===typeof onchange){onchange=onchange.replace('this','this.input');await eval(onchange);}}};return recipeCounter;})();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FComponent%2FrecipeButtons%2FrecipeButtons.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Component/recipeButtons/recipeButtons.js?v=202406200958 **/
var Mrtn=Mrtn||{};Mrtn.recipeButtons=(function(){var recipeButtons=function(params){this.cookbookBtn=document.getElementById('add-recipe-to-cookbook');this.recipe=Mrtn.recipesData.recipes[0];this.bindAll();};recipeButtons.prototype={constructor:recipeButtons,bindAll:function(){if(typeof Mrtn.USER!=='undefined'&&Mrtn.USER.id){this.cookbooks=Mrtn.cookbooks||new Mrtn.Cookbooks({user:Mrtn.USER});Mrtn.cookbooks.pushQueue(this.initCookbookHeart());af_addEvent(this.cookbookBtn,'click',this.onClickBtn.bind(this),false);}
let share=document.getElementById('share-recipe');af_addEvent(share,'click',this.sBtnModalOpen.bind(this),false);},initCookbookHeart:function(){if(Mrtn.cookbooks.has(this.recipe.id)){let iconHeart=this.cookbookBtn.querySelector('.icon-icon_heart');let iconHeartPressed=this.cookbookBtn.querySelector('.icon-icon_heart_pressed');if(iconHeart!==null){iconHeart.classList.remove('icon-icon_heart');iconHeart.classList.add('icon-icon_heart_pressed');}else if(iconHeartPressed!==null){iconHeartPressed.classList.add('icon-icon_heart');iconHeartPressed.classList.remove('icon-icon_heart_pressed');}}},onClickBtn:function(){let iconHeart=this.cookbookBtn.querySelector('.icon-icon_heart');if(iconHeart===null){this.removeRecipeToCookbook();}else{this.addRecipeToCookbook();}},addRecipeToCookbook:function(){af_ua_trackEvent('Recettes','AddCookbook - SummaryBlock - Click','User connecté');let self=this;let successCallback=function(){let recipe=self.cookbooks.getRecipeFromSurId(params.recipeid);if(recipe.length===0){return;}
self.initCookbookHeart();};var params={recipeid:this.recipe.id,recipeTitle:this.recipe.name,categoryguid:this.recipe.category_id,successCallback:successCallback};this.cookbooks.addRecipe(params);},removeRecipeToCookbook:function(){let recipe=this.cookbooks.getRecipeFromSurId(this.recipe.id);if(recipe.length>0){recipe=recipe[0];let params={recipeid:recipe.RecipeSurId,recipeTitle:recipe.Title,categoryguid:recipe.CategoryId};this.cookbooks.removeRecipe(params);this.initCookbookHeart();}},sBtnModalOpen:function(e){var share_modal_class='recipe-buttons-share-modal';var share_modal_visible_class='recipe-buttons-share-modal-visible';var share_modal_element_class='recipe-buttons-share-modal-element';var container=document.querySelector('.recipe-buttons-container');var share_modal=container.querySelector('.'+share_modal_class);share_modal.classList.add(share_modal_visible_class);af_addEvent(document,'click',function(event){if(!event.target.classList.contains(share_modal_class)&&!af_getParent(event.target,'.'+share_modal_class)){share_modal.classList.remove(share_modal_visible_class);}},false);af_addEvent(share_modal.querySelector('.recipe-buttons-share-modal-close'),'click',function(){share_modal.classList.remove(share_modal_visible_class);},false);af_addEvent(share_modal,'click',function(event){if(!event.target.classList.contains(share_modal_element_class)&&!af_getParent(event.target,'.'+share_modal_element_class)){if(unify_dataSlayer!==undefined){unify_dataSlayer.push({event:'uaevent',eventCategory:'Content interaction',eventAction:'Shares',eventLabel:window.location.href,eventNonInt:true,});}}},false);var copyLink=share_modal.querySelector('.recipe-buttons-share-copy-link');af_addEvent(copyLink,'click',function(){navigator.clipboard.writeText(decodeURIComponent(copyLink.getAttribute('data-url'))).then(function(){copyLink.parentNode.querySelector('span').innerText=copyLink.getAttribute('data-done-text');});},false);af_stopEvent(e);}};return recipeButtons;})();var recipeButtons=new Mrtn.recipeButtons();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FComponent%2FdiapoDesktop%2FdiapoDesktop.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Component/diapoDesktop/diapoDesktop.js?v=202406200958 **/
function af_diapo(o){this.log('initialization of class "'+o.id+'"');this.active=false;this.fixed=true;this.diapoID=o.id;this.initPhotos(o);this.current=(o.current?o.current:0);this.main=this.current;this.galleryNumber=1;if(o.refreshDelay&&(!isNaN(o.refreshDelay))){this.refreshDelay=o.refreshDelay;}
this.forwardCallbackURL=(o.forwardCallbackURL?o.forwardCallbackURL:'');this.isInitForwardCallback=false;this.nativeGallery=true;this.isStory=o.isStory?o.isStory:false;this.isOPS=o.isOPS?o.isOPS:false;this.defaultTitle=o.defaultTitle||'';this.noSocialNetwork=o.noSocialNetwork||false;this.shareTitle=(o.shareTitle?o.shareTitle:'');this.shareUrl=(o.shareUrl?o.shareUrl:'');this.sButtons=o.sButtons;this.sButtonsId=o.sButtonsId;this.instanceId=o.instanceId;this.backgroundId=o.backgroundId?o.backgroundId:'af-diapo-background-'+this.instanceId;this.noAds=typeof o.noAds!=="undefined"?o.noAds:false;this.adCallCounter=0;this.alert=o.alert;this.useModalForAlert=o.useModalForAlert||false;Handlebars.registerPartial('diapoPicture',document.getElementById('af-diapo__picture-tmpl').innerHTML);Handlebars.registerPartial('diapoHeader',document.getElementById('af-diapo__header-tmpl').innerHTML);Handlebars.registerPartial('diapoSubHeader',document.getElementById('af-diapo__sub-header-tmpl').innerHTML);this.templates={diapoPicture:Handlebars.compile(document.getElementById('af-diapo__picture-tmpl').innerHTML),diapo:Handlebars.compile(document.getElementById('af-diapo__layout').innerHTML),diapoHeader:Handlebars.compile(document.getElementById('af-diapo__header-tmpl').innerHTML),diapoSubHeader:Handlebars.compile(document.getElementById('af-diapo__sub-header-tmpl').innerHTML),diapoSeeAlso:Handlebars.compile(document.getElementById('mrtn-diapo-see-also').innerHTML)};this.init();}
af_diapo.prototype={constructor:af_diapo,overlayW:1055,overlayH:694,contentW:650,contentH:600,sepW:27,sepH:53,adW:300,adH:600,margin:15,debug:false,log:function(s){if(this.debug&&typeof(console)!=='undefined'&&console.log){console.log(s);}},loadGalleryAtPhoto:function(photoIndex,photoId){this.loadGallery(photoIndex-1);this.show();PubSub.publishSync('diapo:update',{currentPhotoId:photoId,});},init:function(){this.log('> init()');if(!Function.prototype.bind){Function.prototype.bind=function(){var fn=this,args=Array.prototype.slice.call(arguments),object=args.shift();return function(){return fn.apply(object,args.concat(Array.prototype.slice.call(arguments)));};};}
if(!Array.prototype.isset){Array.prototype.isset=function(o){for(var i=0;i<this.length;i++){if(this[i]===o){return true;}}
return false;};}
this.global=document.getElementById('af_diapo_global');if(!this.global){this.log('create global div container');this.global=document.createElement('div');this.global.id='af_diapo_global';this.global.className='af_diapo_global';this.global.style.display='none';this.global.innerHTML='';document.body.insertBefore(this.global,document.body.childNodes[0]);}
this.background=document.getElementById(this.backgroundId);if(!this.background){this.log('create background');this.background=document.createElement('div');this.background.id='af_diapo_background';this.background.className='af_diapo_background';this.background.innerHTML='';this.global.appendChild(this.background);}
this.overlay=document.getElementById('af_diapo_overlay');if(!this.overlay){this.log('create overlay');this.overlay=document.createElement('div');this.overlay.id='af_diapo_overlay';this.overlay.className='af_diapo_overlay';this.overlay.innerHTML='';this.global.appendChild(this.overlay);}
af_addEvent(this.background,'click',(function(){if(this.active){this.hide();}}).bind(this),false);af_shortcuts.add(27,(function(){if(this.active){this.hide();}}).bind(this));var img=document.getElementById(this.diapoID+'_img');var fakeNav=document.getElementById(this.diapoID+'_fakeNav');if(fakeNav){af_addEvent(fakeNav,'click',(function(){this.loadGallery(this.main);this.show();}).bind(this),false);af_addEvent(fakeNav.parentNode,'click',this.stopClickEvent.bind(this),false);}
if(img){af_addEvent(img,'click',(function(){this.loadGallery(this.main);this.show();}).bind(this),false);af_addEvent(img.parentNode,'click',this.stopClickEvent.bind(this),false);}
if(this.background){af_addEvent(this.background,'click',(function(){this.loadGallery(this.main);this.show();}).bind(this),false);af_addEvent(this.background.parentNode,'click',this.stopClickEvent.bind(this),false);}
var prevHandler=function(e){af_stopEvent(e);if(this.isSeeAlso){this.loadGallery(this.nb-1);}else{this.loadPhoto(this.getPrev(),'right');}}.bind(this);var nextHandler=function(e){af_stopEvent(e);if(this.isSeeAlso){return;}else{this.loadPhoto(this.getNext(),'left');}}.bind(this);af_shortcuts.add(37,(function(){if(this.active){prevHandler();}}).bind(this));af_shortcuts.add(32,(function(){if(this.active){nextHandler();}}).bind(this));af_shortcuts.add(39,(function(){if(this.active){ 
nextHandler();}}).bind(this));af_shortcuts.add(36,(function(){if(this.active){ 
this.loadGallery(0);}}).bind(this));af_shortcuts.add(35,(function(){if(this.active){this.loadGallery(this.nb-1);}}).bind(this));var _this=this;PubSub.subscribe('diapo:open',(function(e,data){_this.loadGallery(data.id);_this.show();}).bind(_this));PubSub.subscribe('diapo:alert-photo',function(e,data){_this.alertPicture(data.pictureId,data.alertUrl);});},stopClickEvent:function(e){if(!e.target.parentNode.classList.contains('af-pin-it')){af_stopEvent(e);}},initForwardCallback:function(json){if(this.isInitForwardCallback){return;}
this.forward=null;this.seealso=null;if(json){if(json.type==='continue'){this.forward=json.datas;}else if(json.type==='seealso'){this.seealso=json.datas;}}
this.isInitForwardCallback=true;},canContinue:function(){return this.forward&&this.forward.photos&&this.forward.photos.length>0;},hasSeealso:function(){return this.seealso&&this.seealso.diapos&&this.seealso.diapos.length>0;},createSButtons:function(){PubSub.publish('sButtons'+this.sButtonsId+':asyncInit');var initDoneEvt=PubSub.subscribe('sButtons'+this.sButtonsId+':initDone',af_bind(this,function(){this.updateSButtons();PubSub.unsubscribe(initDoneEvt);}));},updateSButtons:function(){var img=document.getElementById(this.diapoID+'_zoom');PubSub.publish('sButtons'+this.sButtonsId+':refreshDatas',{shareImg:img?img.src:'',shareTitle:this.shareTitle,shareUrl:this.shareUrl});},startSharing:function(){af_gaqTrackEvent('SocialShareDiapo','View','Edito',null,true);},loadPhoto:function(index,animationDirection){this.log('> loadPhoto()');this.isSeeAlso=false;var currIndex=typeof(index)==='number'?index:this.current;var i=currIndex;this.current=currIndex;this.active=true;if(i===this.nb&&!this.canContinue()&&!this.hasSeealso()){return;}
this.callForwardUrl(i);if(i>this.nb-1&&this.canContinue()){this.loadNewGallery(this.forward.photos,this.forward.forwardCallbackURL,this.forward.subtitleLink,this.forward.subtitleLabel);return;}
if(this.isAjax){if(this.photos[i]){this.callNextPhotos(this.photos[i]);}}
if(i===this.nb&&this.hasSeealso()){this.current=i;this.renderSeealso();return;}
var currentImg=this.overlay.querySelector('.af_diapo__img-container');var self=this;var update=function(data){self.updateHeader(data);self.updateURL(i+1);self.callTracking();self.callAd();self.startSharing();if(!self.noSocialNetwork){self.createSButtons();}
self.addAlertEvent();PubSub.publishSync('diapo:update',{currentPhotoId:data.photoId,});};if(!this.photos[currIndex]){return;}
var data=this.getDataToRender(this.photos[currIndex]);var pictureHtml=this.templates.diapoPicture(data);currentImg.classList.remove('inleft');currentImg.classList.remove('inright');if(animationDirection){var animation={left:{in:'inright',out:'outleft'},right:{in:'inleft',out:'outright'}};currentImg.classList.add(animation[animationDirection].out);setTimeout(function(){currentImg.classList.remove(animation[animationDirection].out);self.overlay.querySelector('.af_diapo__img-container').innerHTML=pictureHtml;self.overlay.querySelector('.af_diapo__img-container').classList.add(animation[animationDirection].in);update(data);},500);}else{this.overlay.querySelector('.af_diapo__img-container').innerHTML=pictureHtml;update(data);}},updateHeader:function(data){var headerHtml=this.templates.diapoHeader(data);var subHeaderHtml=this.templates.diapoSubHeader(data);this.overlay.querySelector('.af_diapo__right-container__header').innerHTML=headerHtml;this.overlay.querySelector('.af_diapo__right-container__sub-header').innerHTML=subHeaderHtml;this.addCloseEvent();},loadNewGalleryFromURL:function(url){af_requestGet(url,'',(function(json){this.loadNewGalleryFromURLCallback(json);}).bind(this),true);},loadNewGalleryFromURLCallback:function(json){this.isInitForwardCallback=false;this.initForwardCallback(json);if(this.canContinue()){this.loadNewGallery(this.forward.photos,this.forward.forwardCallbackURL,this.forward.subtitleLink,this.forward.subtitleLabel);}},loadNewGallery:function(photos,forwardCallbackURL,subtitleLink,subtitleLabel){this.log('> loadNewGallery('+photos+','+forwardCallbackURL+','+subtitleLink+','+subtitleLabel+')');if(typeof this.save==='undefined'){this.save=this.photos;this.saveCallbackURL=this.forwardCallbackURL;}
this.photos=photos;this.isAjax=false;this.nb=this.photos.length;this.current=0;this.main=this.current;this.forwardCallbackURL=forwardCallbackURL;this.isInitForwardCallback=false;this.subtitleLink=subtitleLink;this.subtitleLabel=subtitleLabel;this.shareUrl='http://'+document.location.host+subtitleLink;this.shareTitle=subtitleLabel;this.galleryNumber++;this.nativeGallery=false;this.forward=null;this.loadGallery(0);},renderSeealso:function(){var that=this;this.updateHeader({isSeeAlso:true,seealsoReplayTitle:that.seealso.seealsoReplayTitle});var seealsoContainer=document.querySelector('.af_diapo__left-container'),data=this.seealso,html=this.templates.diapoSeeAlso(data);seealsoContainer.innerHTML=html;for(var k=0;k<this.seealso.diapos.length;k++){var item=this.seealso.diapos[k];var link=document.getElementById('af_seealso_link_'+item[0]);if(link){af_addEvent(link,'click',(function(url,pos){return function(e){af_stopEvent(e);this.loadNewGalleryFromURL(url);return false;};}(item[4],k+1)).bind(this),true);}}
this.active=true;this.updateURL(0,'seealso');this.callTracking();this.callAd();var DiapoBtnReloadLink=document.getElementById('diapo-btn-reload-link');if(DiapoBtnReloadLink){af_addEvent(DiapoBtnReloadLink,'click',(function(j){return function(e){af_stopEvent(e);this.loadGallery(j);};}(0)).bind(this),true);}
if(!this.noSocialNetwork){this.createSButtons();}
this.isSeeAlso=true;},getPrev:function(){var index=this.current;var j=index-1;return j<0?0:j;},getNext:function(){var index=this.current;var k=index+1;return k>this.nb-1&&!this.canContinue()&&!this.hasSeealso()?this.nb-1:k;},getDataToRender:function(photo){var data={diapoTitle:photo[4],photoCredits:photo[6],currentIndex:Number(this.current)+1,nbPhotos:this.nb,diapoID:this.diapoID,photoSrc:photo[1],sButtons:this.sButtons,subtitleLink:this.subtitleLink,subtitleLabel:this.subtitleLabel,photoId:photo[0],hasAlert:this.alert?true:false,photoDescription:photo[8],isOPS:this.isOPS,descriptionClass:this.isOPS?' open ':'',subHeaderClass:this.isOPS?' sub-header-bottom-ops ':'',ratingComponent:af_rating_component};return data;},loadGallery:function(i){this.log('> loadGallery('+i+')');this.isSeeAlso=false;this.callForwardUrl(i);if(i<0||i>this.nb-1){return;}
this.current=i;this.active=true;if(!this.photos[i]){return;}
var data=this.getDataToRender(this.photos[i]);var diapoHtml=this.templates.diapo(data);this.overlay.innerHTML=diapoHtml;var that=this;setTimeout(function(){that.global.classList.add('af_diapo_global--open');},100);document.body.style.overflow='hidden';af_addEvent(this.global,'click',function(e,el){this.clickHandler(e);}.bind(this),false);this.bindPrevNext();this.updateURL(i+1);this.callTracking();this.initAd();this.callAd(true);this.startSharing();if(!this.noSocialNetwork){this.createSButtons();}
this.addAlertEvent();},bindPrevNext:function(){var prevBlock=this.overlay.querySelector('#af_diapo_left');if(prevBlock){af_addEvent(prevBlock,'click',function(e){af_stopEvent(e);if(this.isSeeAlso){this.loadGallery(this.nb-1);}else{this.loadPhoto(this.getPrev(),'right');}}.bind(this),true);}
var nextBlock=this.overlay.querySelector('#af_diapo_right');if(nextBlock){af_addEvent(nextBlock,'click',function(e){af_stopEvent(e);this.loadPhoto(this.getNext(),'left');}.bind(this),true);}},updateURL:function(page,extra){var suffix=(page>0?'-p'+page:(extra?'-'+extra:''));if(suffix){if(this.photos[this.current]&&this.photos[this.current][0]){var hash='d'+this.photos[this.current][0];}else{var hash=location.hash;}
location.hash=hash+suffix;}},show:function(top,left){this.log('> show('+top+','+left+')');this.global.style.display='';},hide:function(){this.log('> hide()');this.active=false;this.global.classList.remove('af_diapo_global--open');var that=this;setTimeout(function(){that.global.style.display='none';that.overlay.innerHTML='';},200);if(this.fixed){document.body.style.marginRight='0px';document.body.style.overflow='visible';}
if(typeof this.save!=='undefined'){this.photos=this.save;this.nb=this.photos.length;this.current=0;this.main=this.current;this.forwardCallbackURL=this.saveCallbackURL;this.subtitleLink='';this.subtitleLabel='';this.nativeGallery=true;this.isInitForwardCallback=false;this.forward=null;if(this.forwardCallbackURL!==''){af_requestGet(this.forwardCallbackURL,'',(function(json){this.initForwardCallback(json);}).bind(this),true);}}
this.resetAd();},adPlacementSlot:'',initAd:function(){this.adFormatId='300_diapodynamic';if(window.afAd&&!this.noAds&&window.afAd.name!=='somtag'){if(!this.adPlacementSlot){var renderParams={createParams:{container:document.getElementById('overlayDiapoPub'),mode:'inside'},hasRefresh:true,refreshParams:{extraTarget:(this.nativeGallery?'':';notNativeGallery'),mode:'instant'},isAsync:true};if(af_diapo_common.ads&&af_diapo_common.ads.adLabel){renderParams.createParams.adLabel=af_diapo_common.ads.adLabel;}
this.adPlacementSlot=afAd.render(this.adFormatId,renderParams);this.adTagId=this.adPlacementSlot.id;}
afAd.publish('ad.refresh.stop');}else if(window.afAd&&!this.noAds&&window.afAd.name==='somtag'){this.adFormatId='rectangle1';this.adTagId='div-somtag-rectangle1';var container=document.getElementById('overlayDiapoPub');var rectangle1=document.getElementById(this.adTagId);container.appendChild(rectangle1);afAd.publish('ad.refresh.stop');}else if(!this.noAds){if(!this.adPlacementSlot){this.adPlacementSlot=document.createElement('div');this.adPlacementSlot.dataset.ad=this.adFormatId;document.getElementById('overlayDiapoPub').insertAdjacentElement('afterbegin',this.adPlacementSlot);this.adContainer=document.createElement('div');this.adContainer.className='ad-container ad-container-'+this.adFormatId;this.adPlacementSlot.parentNode.insertBefore(this.adContainer,this.adPlacementSlot);this.adContainer.appendChild(this.adPlacementSlot);}}},resetAd:function(){if(window.afAd){if(window.afAd.name==='somtag'){var container=document.getElementById('div-somtag-rectangle1_wrapper');var rectangle1=document.getElementById('div-somtag-rectangle1');container.appendChild(rectangle1);this.callAd(true);}
this.adPlacementSlot='',afAd.publish('ad.refresh.start');}},callAd:function(isToggleCall){isToggleCall=isToggleCall||false;this.adCallCounter++;if(window.afAd&&!this.noAds){var params={formatIds:this.adFormatId,tagId:this.adTagId};if(typeof this.refreshDelay==='number'&&!isToggleCall){params.delay=this.refreshDelay;}else if(isToggleCall&&window.afAd.name==='somtag'){params.delay=0;}
afAd.refreshAds(params);}
if(window.pegasus&&this.adCallCounter%3<1&&!this.noAds){pegasus.refreshSlot(this.adFormatId,true);}},clickHandler:function(e){var closeEvent=(function(){return function(e){af_stopEvent(e);this.hide();};}()).bind(this);var actions={'af_diapo_closeBtn':closeEvent};function hasAction(el){var action=false;Object.keys(actions).forEach(function(key){if(el.classList.contains(key)){action={action:actions[key]};}});return action;}
var el=e.target;while(el&&el.parentNode){var act=hasAction(el);if(act){act.action();break;}else{el=el.parentNode;}}},addCloseEvent:function(){var closeEvent=(function(){return function(e){af_stopEvent(e);this.hide();};}()).bind(this);var closeBtn=document.getElementById('af_diapo_closeBtn');if(closeBtn){af_addEvent(closeBtn,'click',closeEvent,true);}},addAlertEvent:function(){var alertBtn=document.getElementById('af_diapo_alert_btn');var that=this;var alertEvent=function(e){af_stopEvent(e);var pictureId=this.dataset.pictureId;var pictureUrl=this.dataset.pictureUrl;if(that.useModalForAlert){PubSub.publish('diapo:alert-photo-modal',{pictureId:pictureId,alertUrl:that.alert.url,pictureUrl:pictureUrl});}else{that.alertPicture(pictureId,that.alert.url);}};if(alertBtn){af_addEvent(alertBtn,'click',alertEvent,true);}},alertPicture:function(pictureId,alertUrl){var queryString='pictureid='+Number(pictureId);AfHttpRequest.post(alertUrl,queryString);},callTracking:function(){this.log('> callTracking()');var suffix=(this.isStory?'storygally':'gally');af_callTracking(suffix);},initPhotos:function(o){if(typeof o.nextPhotosCallbackURL!=='undefined'&&o.nextPhotosCallbackURL!==''){this.nextPhotosCallbackURL=o.nextPhotosCallbackURL;this.isAjax=true;this.minOrder=o.photos[0][7];this.maxOrder=o.photos[0][7];this.photos=[];for(var i=0;i<o.photos.length;i++){this.photos[o.photos[i][7]-1]=o.photos[i];if(o.photos[i][7]>this.maxOrder){this.maxOrder=o.photos[i][7];}
if(o.photos[i][7]<this.minOrder){this.minOrder=o.photos[i][7];}}}else{this.nextPhotosCallbackURL='';this.isAjax=false;this.photos=o.photos;}
this.nb=(typeof o.diapoSize!=='undefined')?o.diapoSize:this.photos.length;},callNextPhotos:function(photo){if(photo){var photoOrder=photo[7];var preloadedMargin=10;var positionStart=null;var positionEnd=null;if(photoOrder+preloadedMargin<=this.nb&&photoOrder+preloadedMargin>this.maxOrder){positionStart=this.maxOrder-1;positionEnd=positionStart+preloadedMargin;}else if(photoOrder-preloadedMargin>=1&&photoOrder-preloadedMargin<this.minOrder){positionEnd=this.minOrder-1;positionStart=positionEnd-preloadedMargin;}
if(positionStart!==null){af_requestGet(this.nextPhotosCallbackURL+'&positionStart='+positionStart+'&positionEnd='+positionEnd,'',(function(data){var feedPhotos=data['_embedded']['albumphoto']||data['_embedded']['recipe_picture'];for(var i=0;i<feedPhotos.length;i++){var order=feedPhotos[i]['order'];if(typeof this.photos[order-1]==='undefined'){var photoData=this.extractPhotoFromFeed(feedPhotos[i]);this.photos[order-1]=photoData;if(order>this.maxOrder){this.maxOrder=order;}
if(order<this.minOrder){this.minOrder=order;}}}}).bind(this),true);}}},extractPhotoFromFeed:function(photo){var result=[];result.push(photo['photoId']);result.push(photo['images']['main']);var width=photo['width'];var height=photo['height'];if(width>this.contentW){width=this.contentW;height=parseInt(photo['height']*(this.contentW/photo['width']));}
if(height>this.contentH){height=this.contentH;width=parseInt(photo['width']*(this.contentH/photo['height']));}
result.push(width);result.push(height);result.push(photo['title']);result.push(photo['images']['thumb']);if(typeof photo['credit']!=='undefined'){result.push(photo['credit']);}else{result.push('');}
result.push(photo['order']);if(typeof photo['text']!=='undefined'){result.push(photo['text']);}else{result.push('');}
return result;},callForwardUrl:function(photoIndex){if(this.forwardCallbackURL!==''&&!this.isInitForwardCallback&&this.nb-photoIndex<10){af_requestGet(this.forwardCallbackURL,'',(function(json){this.initForwardCallback(json);}).bind(this),true);}},};function expandDescription(id){document.getElementById('description-'+id).classList.add('open');document.getElementById('expand-'+id).classList.add('af-diapo-hide');}
function af_diapo_init(){if(typeof(af_diapo_list)!=='undefined'&&af_diapo_list!==null){for(var i=0,l=af_diapo_list.length;i<l;i++){if(typeof(af_diapo_list[i])!=='undefined'&&af_diapo_list[i].id){af_diapo_instances[af_diapo_list[i].id]=new af_diapo(af_diapo_list[i]);}}
af_diapo_list=null;}}
af_diapo_init();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FComponent%2FrecipeMediaViewerV2%2FrecipeMediaViewerV2.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Component/recipeMediaViewerV2/recipeMediaViewerV2.js?v=202406200958 **/
var Mrtn=Mrtn||{};Mrtn.RecipeMediaViewerV2=(function(){let recipeMediaViewerV2=function(){if(af_isMobile()){this.targetDiapoMobileLink();}else{this.openDiapoDesktop();}
this.uploadPicture();};recipeMediaViewerV2.prototype={constructor:recipeMediaViewerV2,uploadPicture:function(){let uploadFileDiapo=document.querySelectorAll('.upload-file-diapo');if(uploadFileDiapo.length>0){for(let i=0;i<uploadFileDiapo.length;i++){this.myDropzone=new Dropzone(uploadFileDiapo[i],{url:'/reloaded/api/recipe/uploadpicture',maxFilesize:10,parallelUpload:1,uploadMultiple:false,acceptedFiles:".png,.jpg,.jpeg",previewContainer:false,clickable:'.upload-file-diapo',autoProcessQueue:true,maxFiles:1,});}
this.myDropzone.on('sending',function(file,xhr,formData){formData.append('userid',Mrtn.USER.id);formData.append('authorname',Mrtn.USER.name);formData.append('originid',Mrtn.RECIPE.id);formData.append('type','recipe');formData.append('isfirstpicture',false);});this.myDropzone.on('complete',function(){PubSub.publish('noty',{content:'<p>Merci pour votre contribution!</p>'});setTimeout(function(){window.location.reload();},1500);});}},openDiapoDesktop:function(){let mainPicture=document.getElementById('recipe-media-viewer-main-picture');af_addEvent(mainPicture,'click',function(){PubSub.publish('diapo:open',{id:0});});for(var i=0;i<3;i++){let targetThumbnail=document.getElementById('recipe-media-viewer-thumbnail-'+i);let id=i;af_addEvent(targetThumbnail,'click',function(){PubSub.publish('diapo:open',{id:id});});}
let moreThumbnail=document.getElementById('recipe-media-viewer-thumbnail-more');af_addEvent(moreThumbnail,'click',function(){PubSub.publish('diapo:open',{id:3});});},targetDiapoMobileLink:function(){let pictures=document.querySelectorAll('.recipe-media-viewer-picture');for(let item of pictures){this.setDiapoMobileLink(item);}
let moreThumbnail=document.querySelector('#recipe-media-viewer-thumbnail-more');if(moreThumbnail){this.setDiapoMobileLink(moreThumbnail);}},setDiapoMobileLink:function(item){let wrapper=document.createElement('a');wrapper.setAttribute('href','/recettes/diapo/'+Mrtn.RECIPE.id);wrapper.setAttribute('rel','nofollow');item.parentNode.insertBefore(wrapper,item);wrapper.appendChild(item);}};return recipeMediaViewerV2;})();




/********** https://www.marmiton.org/reloaded/static/preconcat_%2Freloaded%2Fstatic%2FFront%2FComponent%2FrecipeHeader%2FrecipeHeader.js.202406200958.js **********/

/** https://www.marmiton.org/reloaded/static/Front/Component/recipeHeader/recipeHeader.js?v=202406200958 **/
var Mrtn=Mrtn||{};Mrtn.RecipeHeader=(function(){var recipeHeader=function(){this.popOver=document.querySelector('.show-more__modal');this.popOverCloseBtn=this.popOver.querySelector('.show-more__close');this.recipeInfoBtn=document.querySelector('.main-title > h1');var recipeHeaderBrand=document.querySelector('.recipe-header__brand');af_addEvent(this.recipeInfoBtn,'click',this.openPopOver.bind(this));af_addEvent(this.popOverCloseBtn,'click',this.closePopoverOnClick.bind(this));af_addEvent(document,'click',this.closePopover.bind(this),false);if(recipeHeaderBrand){var recipeHeaderBrandLinks=recipeHeaderBrand.getElementsByTagName('a');for(var i=0;i<recipeHeaderBrandLinks.length;i++){af_addEvent(recipeHeaderBrandLinks[i],'click',function(e){af_ua_trackEvent('OPS','BrandRecipe - RecipePageBrandLink - Click','['+e.target.getAttribute('data-recipeUserName')+'] - '+e.target.getAttribute('data-recipeUrlComplete'));},false);}}};recipeHeader.prototype={constructor:recipeHeader,openPopOver:function(e){this.popOver.style.display='';af_ua_trackEvent('Recettes','nutriscore',Mrtn.recipesData.recipes[0].nutri_score,'');e.stopPropagation();},closePopoverOnClick:function(){this.popOver.style.display='none';},closePopover:function(e){if(!e.target.classList.contains('show-more__modal')&&af_findAncestor(e.target,'show-more__modal')===null){this.popOver.style.display="none";}}};return recipeHeader;})();var recipeHeader=new Mrtn.RecipeHeader();




